# Default values for openclaw.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Number of replicas (OpenClaw should run as a single instance)
replicaCount: 1

# -- OpenClaw image repository, pull policy, and tag version
image:
  repository: ghcr.io/obolnetwork/openclaw
  pullPolicy: IfNotPresent
  tag: "2026.2.9"

  # -- Override the container command (ENTRYPOINT)
  command:
    - node
  # -- Override the container args (CMD)
  args:
    - openclaw.mjs
    - gateway
    - --allow-unconfigured

  # -- Additional environment variables for the container
  env: []
  # - name: FOO
  #   value: bar

# -- Credentials to fetch images from private registry
imagePullSecrets: []

# -- Override the chart name
nameOverride: ""
# -- Override the full resource name
fullnameOverride: ""

# -- Create a ServiceAccount for OpenClaw
serviceAccount:
  create: true
  # -- Automatically mount a ServiceAccount's API credentials?
  # Set to true when rbac.create is true so the agent can access the K8s API.
  automount: false
  annotations: {}
  # -- ServiceAccount name. Required when serviceAccount.create=false and rbac.create=true.
  name: ""

# -- RBAC for the ServiceAccount (read-only access to namespace resources)
rbac:
  create: false
  # -- Extra rules to append to the generated Role (list of PolicyRule objects)
  extraRules: []

# -- One-shot init Job (runs once to bootstrap workspace/personality)
initJob:
  # -- Enable a one-shot post-install bootstrap Job. Requires persistence.enabled=true.
  enabled: false
  image:
    repository: ghcr.io/obolnetwork/openclaw
    tag: ""
    pullPolicy: IfNotPresent
  command:
    - node
    - openclaw.mjs
    - agent
    - init
  args: []
  # -- Extra environment variables for the init job
  env: []
  # -- Resource requests/limits for the init job
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 512Mi

# -- Pod annotations
podAnnotations: {}
# -- Pod labels
podLabels: {}

# -- Pod security context
podSecurityContext:
  fsGroup: 1000

# -- Container security context
containerSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# -- Service configuration
service:
  type: ClusterIP
  port: 18789

# -- Kubernetes Ingress (optional; not used in Obol Stack which uses Gateway API)
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# -- Gateway API HTTPRoute (recommended for Obol Stack / Traefik Gateway API)
httpRoute:
  enabled: false
  annotations: {}
  # -- Hostnames for routing (required when enabled)
  hostnames: []
  # - openclaw-myid.obol.stack
  parentRefs:
    - name: traefik-gateway
      namespace: traefik
      sectionName: web
  pathPrefix: /

# -- Persistence settings for OpenClaw state directory (contains runtime state + secrets)
persistence:
  enabled: true
  existingClaim: ""
  storageClass: ""
  accessModes:
    - ReadWriteOnce
  size: 1Gi
  mountPath: /data

# -- Configuration for the OpenClaw config file (openclaw.json)
config:
  # -- Use an existing ConfigMap instead of creating one
  existingConfigMap: ""
  # -- ConfigMap key / filename
  key: openclaw.json
  # -- Optional raw JSON5 configuration (overrides generated config when set)
  content: ""

# -- OpenClaw state/workspace settings (paths should be inside persistence.mountPath)
openclaw:
  stateDir: /data/.openclaw
  workspaceDir: /data/.openclaw/workspace
  # -- Default agent model (e.g. "anthropic/claude-sonnet-4-5-20250929"). Empty = use provider default.
  agentModel: ""

  gateway:
    mode: local
    bind: lan
    auth:
      mode: token
    # -- IP addresses / CIDRs whose proxy headers (X-Forwarded-For etc.) are trusted.
    # Required when OpenClaw sits behind a reverse proxy (e.g. Traefik in k3d).
    trustedProxies: []
    # -- Control UI settings for browser-based access.
    controlUi: {}

    http:
      endpoints:
        chatCompletions:
          enabled: true

# -- Model provider configuration
# Each provider is independently toggled. All providers may be disabled.
# API keys are stored in the chart Secret and injected as env vars.
models:
  anthropic:
    enabled: false
    baseUrl: https://api.anthropic.com/v1
    api: ""
    apiKeyEnvVar: ANTHROPIC_API_KEY
    # -- API key value (stored in Secret). Leave empty to provide via extraEnvFromSecrets.
    apiKeyValue: ""
    models:
      - id: claude-sonnet-4-5-20250929
        name: Claude Sonnet 4.5
      - id: claude-opus-4-6
        name: Claude Opus 4.6
  openai:
    enabled: false
    baseUrl: https://api.openai.com/v1
    api: ""
    apiKeyEnvVar: OPENAI_API_KEY
    apiKeyValue: ""
    models:
      - id: gpt-5.2
        name: GPT-5.2
  ollama:
    enabled: true
    # -- OpenAI-compatible base URL for Ollama (routed through llmspy global proxy)
    baseUrl: http://llmspy.llm.svc.cluster.local:8000/v1
    # -- OpenClaw provider API type. Set to "openai-completions" because llmspy exposes an OpenAI-compatible chat/completions endpoint.
    api: "openai-completions"
    # -- Env var used for provider API key interpolation in openclaw.json
    apiKeyEnvVar: OLLAMA_API_KEY
    # -- Value set for the apiKey env var (not a secret for Ollama)
    apiKeyValue: ollama-local
    models:
      - id: glm-4.7-flash
        name: glm-4.7-flash

# -- Chat channel integrations
# Tokens are stored in the chart Secret and injected as env vars.
channels:
  telegram:
    enabled: false
    # -- Telegram Bot API token (from @BotFather)
    botToken: ""
    # -- DM policy: "open" | "paired" | "closed"
    dmPolicy: ""
  discord:
    enabled: false
    # -- Discord bot token
    botToken: ""
    # -- DM policy: "open" | "paired" | "closed"
    dmPolicy: ""
  slack:
    enabled: false
    # -- Slack Bot User OAuth Token (xoxb-...)
    botToken: ""
    # -- Slack App-Level Token (xapp-...)
    appToken: ""

# -- Skills injection from a ConfigMap archive (created by an external tool; e.g. `obol openclaw skills sync`).
# The archive is extracted to `extractDir` by a busybox init container and wired into OpenClaw
# via `skills.load.extraDirs` in _helpers.tpl. Note: ConfigMap total size is limited to ~1 MB by Kubernetes.
skills:
  enabled: false
  # -- Create a default empty skills ConfigMap when configMapName is not set.
  # This allows the chart to deploy without requiring an external ConfigMap.
  # Use `obol openclaw skills sync` to populate it later.
  createDefault: true
  # -- Name of the ConfigMap containing the skills archive (overrides createDefault)
  configMapName: ""
  archiveKey: skills.tgz
  extractDir: /data/.openclaw/skills-injected
  initContainer:
    image:
      repository: busybox
      tag: 1.36.1
      pullPolicy: IfNotPresent

# -- eRPC integration (exposed as ERPC_URL env var)
erpc:
  url: http://erpc.erpc.svc.cluster.local:4000/rpc

# -- OpenClaw secrets (one Secret per instance)
secrets:
  # -- Use an existing secret instead of creating one
  existingSecret: ""
  # -- Create the secret when existingSecret is not set
  create: true
  # -- Override the created Secret name (defaults to <release>-openclaw-secrets)
  name: ""

  gatewayToken:
    # -- Secret key name + env var name for the gateway API authentication token.
    # This token is required to access OpenClaw's HTTP gateway (chat/completions endpoint and dashboard).
    key: OPENCLAW_GATEWAY_TOKEN
    # -- Explicit token value. Required for token auth unless using secrets.existingSecret.
    value: ""

  # -- Extra Secret names to load via envFrom (for provider/channel keys, etc.)
  extraEnvFromSecrets: []

# -- Resource requests and limits
resources:
  requests:
    cpu: 250m
    memory: 512Mi
  limits:
    memory: 2Gi

# -- Startup probe (tcpSocket; allows generous boot time before liveness kicks in)
startupProbe:
  enabled: true
  periodSeconds: 5
  failureThreshold: 30
  timeoutSeconds: 3

# -- Liveness probe (tcpSocket by default to avoid auth-protected HTTP endpoints)
livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

# -- Readiness probe (tcpSocket by default to avoid auth-protected HTTP endpoints)
readinessProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# -- Additional volumes
extraVolumes: []
# -- Additional volume mounts
extraVolumeMounts: []
# -- Additional environment variables
extraEnv: []

nodeSelector: {}
tolerations: []
affinity: {}
priorityClassName: ""
